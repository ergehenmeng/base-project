## 业务说明

### 商户相关

* 商户创建或编辑时,可以选择商户可以经营的品类, 例如: 门票, 民宿等. 具体品类在 `ProductType` 定义中定义
* 商户所能经营的品类和角色有关联关系, 具体在 `RoleMapping` 中映射
* 商户创建时,默认会创建商户管理员用户, 该用户具有商户管理权限, 同时平台有权对其的账户进行管理: 锁定, 解锁, 重置密码,
  调整费率, 导出, 解绑(用于绑定微信号进行通知或提现等操作)
* 商户同样可以自己进行绑定微信号(移动端)或更换微信号, 用于通知或提现等操作
* 商户可以创建自己的用户或角色, 用来管理自己的店铺等
* 商户创建时, 默认会初始化一个积分账户, 资金账户. 零售, 民宿, 餐饮, 旅行社类型的商户, 额外会初始化一个店铺
* 商户下的所有店铺资金默认进同一个账户, 可以对其进行提现(未实现)

### 活动日历相关

* 活动主要用在景区上, 目前是单独的一个模块
* 景区详情默认会显示最近7天(系统参数控制)的活动日历
* 由于景区可能每天都有一样的活动, 列表展示可能有重复的, 因此建议按前端展示时按日期进行分组

### 资讯相关
* 资讯配置用于生成某一类资讯的模板, 每类模板都可以添加不同的资讯
* 资讯支持评论, 点赞, 收藏等功能

### 留言相关

* 目前只支持新闻类资讯和景区活动两个模块的评论
* 普通用户可以对评论进行点赞或者举报
* 默认评论直接展示, 但是可以对评论进行屏蔽, 置顶, 取消置顶
* 如果移动端留言被20人(可以由系统参数配置)举报, 默认自动屏蔽

### 民宿相关

* 商户创建时, 默认会创建一个民宿店铺, 商户可以对民宿店铺进行编辑, 上下架,删除等操作
* 民宿是商户经营的类型, 有编辑, 上下架, 删除等操作, 平台也可以对其强制下架(强制下架的民宿不会在允许上架)
* 民宿下面有房型, 有新增, 编辑, 上下架, 删除, 推荐房型(用于展示在民宿首页)等操作
* 房型有价格日历可以配置
* 用户下完民宿订单后, 如果设置的是手动确认是否有房时, 需要商户后台审核, 审核通过才可入住, 如果审核无房, 则退款
* 不支持部分退

### 零售相关

* 商户创建时, 默认会生成一个零售店铺, 商户可以对零售店铺进行编辑, 上下架, 删除等操作
* 零售有新增, 编辑, 上下架, 删除, 推荐商品, 排序等操作
* 由于零售有物流, 因此同样有快递模板管理
* 零售标签管理(平台用户统一维护)
* 零售除了正常的订单, 还可以参与拼团,限时购
* 零售是唯一支持购物车的品类
* 零售订单有发货, 退款, 更新快递单号
* 零售不支持同一个商品部分退(即:一个订单下单了 `A*2 B*3`, 退款时只能退 `A*2` 或 `B*3`, 不支持 `A*1` 等情况)
* 零售支持未发货退款,已发货退款, 已签收退款, 已完成退款(默认订单完成7天内依旧可以退款), 具体由系统参数控制
* 针对已支付退款操作, 多商品时优惠券和积分按比例进行退款, 由于可能出现除不尽情况,最后一笔退款按总价-已退款金额进行退款
* 支持未支付改价操作
* 目前暂不支持自提

### 线路相关

* 商户创建时, 默认会生成一个旅行社, 商户可以对旅行社进行编辑, 上下架, 删除等操作
* 线路有新增, 编辑, 上下架, 删除, 排序等操作, 线路可以根据配置的天数配置每一天的活动
* 支持部分退

### 餐饮券相关
* 商户创建时, 默认会生成一个餐饮店铺, 商户可以对餐饮店铺进行编辑, 上下架, 删除等操作
* 餐饮店铺 编辑, 上下架, 删除, 推荐商品, 排序等操作
* 店铺下可以创建餐饮券, 餐饮券有新增, 编辑, 上下架, 删除, 推荐商品, 排序等操作
* 支持部分退

### 景区门票相关
* 商户可以创建多个景区, 商户可以对景区进行新增, 编辑, 上下架, 删除等操作
* 景区下可以创建门票, 门票有新增, 编辑, 上下架, 删除, 排序等操作
* 门票没有价格日历的概念
* 景区下可以挂载活动 (活动本身是由平台维护的)
* 门票目前自闭环, 后续可以接入第三方(需要二次开发)
* 门票支持强制线下退款 (核销后强退)
* 支持部分退

### 场馆相关
* 场馆类商户可以创建多个场馆, 商户可以对场馆进行新增, 编辑, 上下架, 删除等操作
* 场馆下可以创建场馆场地, 场地有新增, 编辑, 上下架, 删除, 排序等操作
* 场地可以进行排班和价格设置
* 场地预约支持零元购, 如果退款也无需审核
* 不支持部分退

### 订单评价
* 目前支持零售, 门票, 民宿, 线路, 餐饮券(不支持场馆)
* 订单完结30天内可以评价订单,否则生成默认评价
* 注意: 评论信息会有平台人员进行审核, 通过审核后才会展示给用户

### 核销相关
* 目前支持零售(由于零售没有线下自提, 该功能目前比较鸡肋), 门票, 民宿, 线路, 餐饮券, 场馆
* 扫码核销需要在移动端实现

### 积分相关

* 积分是平台账户的虚拟币, 用于抵扣商品价格, 同时商户自己也可以通过抽奖等给用户发放积分, 也可以通过订单支付收取积分(
  用户支付的积分)
* 商户积分可以充值, 同样可以提现, 注意: 充值方式有两种(余额充值, 微信或支付宝充值), 提现只能提现到商户余额
* 积分提现时不会额外生成积分提现记录, 只有积分变动记录
* 积分充值时同样只有积分变动记录, 没有充值记录
* 积分只适用于零售商品(含拼团和限时购), 不能用于其他类型商品

### 资金账户相关

* 商户资金余额包含: 可用余额 + 冻结金额(支付冻结)
* 所有涉及上述两项金额变动均的操作均需要添加资金记录 `account_log`
* 订单支付时, 额外会增加资金冻结记录
* 订单退款时, 会更新资金冻结记录
* 商户提现时, 额外增加提现记录

### 区域导览
* 区域导览可以创建多个区域
* 每个区域可以创建不同的点位类型, 同样可以创建不同的点位
* 点位可以是景点, 商家, 商家商品, 商家店铺等
* 区域下可以创建线路, 每个线路可以关联多个点位

### 营销活动相关

#### 优惠券

* 优惠券可以是满减券或折扣券
* 注意: 优惠券编辑时, 不能修改使用范围,使用时间,金额,优惠金额等
* 优惠券所使用的范围: 支持除零售(待开发)之外的所有品类
* 优惠券可以手动发放给指定的人员, 也可以通过通过领券中心让用户自己领取
* 目前只支持商户优惠券, 且使用范围为: 店铺或指定商品(所有商品), 一个优惠券只能用一个店铺或一个店铺下的商品, 不建议多店铺商品用同一类型的优惠券(如需:建议创建不同店铺的优惠券)
* 零售商品详情页会展示可以领取的优惠券
* 支持优惠券的品类: 全部

#### 拼团

* 拼团只能是单个商品(零售), 不支持阶梯价格优惠的拼团设置
* 在拼团有效期结束时, 所有没有拼团成功的订单会自动取消
* 未成团之前,如果团长取消订单, 所有参团的订单都会自动取消
* 成团后订单取消, 不会取消其他人的订单(团长也一样)
* 有专门限时购活动页面展示


#### 限时购

* 限时购同时支持多个商品(零售)
* 有专门限时购活动页面展示

#### cdKey

* 兑换码配置生成后, 需要手动生成cdKey, 且只能生成一次, 通过导出cdKey让运营人员使用
* 兑换码支持民宿, 餐饮券, 线路, 场馆四类商品
* 退款时兑换码不会自动退回
* cdKey属于平台优惠, 因此其使用范围需要线下跟对应商户或门店进行沟通,方便结算
* 默认情况下, 兑换码只能在指定的门店使用, 如需在指定商品使用, 可以设置系统参数 `redeem_code_scope`;
* 支持兑换码的品类: 民宿, 线路, 场馆(只要涉及部分退的商品均不支持兑换码)

#### 抽奖相关

* 抽奖活动只适用于零售店铺, 可以指定某个店铺,也可以指定一个商户下的所有店铺
* 目前抽奖奖品支持: 优惠券, 积分
* 如果优惠数量不足或优惠券中奖配置数量不足或商户积分余额不足或积分中奖配置不足, 抽奖时会变成 `谢谢参与`

### 版本相关
* 版本主要针对原生应用更新使用的
* 版本号支持范围: 0.0.01~99.99.99
* 可以设置强制更新, 不强制更新(业务接口兼容性, 需要自行判断)

### banner相关
* banner原本是为了PC广告位使用, 如果需要在小程序或原生应用上使用, 需要考虑页面跳转链接的配置(需要自行和前端对接)
* banner默认是走缓存的, 更新后需要刷新缓存才会生效(不手动刷新时默认30分钟自动刷新)

### 关于分账
* 订单完成后第14天就行分账, 但是分账的接口需要自己实现
* 由于零售支持订单完成后退款, 因此分账时间要大于可退款时间(系统参数配置), 否则可能需要分账回退等操作

### 其他说明

* 零售, 民宿, 餐饮, 旅行社类商户在注册时会生成一个店铺(继承`MerchantInitService`), 因此在上架店铺时,需要校验店铺数据是否完善. 同时可以创建多个店铺(需要平台账户创建)
* 支持零元购的品类: 门票(零元付不支持退票), 场馆(零元付支持退票), 零售(零元付支持退款[因为可能使用了积分抵扣])
* 针对支付,退款等调用第三方接口(含异步回调), 均会记录日志, 方便后续排查问题
* 支持退款审核商品: 零售, 民宿, 线路. 其他品类订单退款时直接退(无需审核)
* 为了防止有人恶意调用接口, 管理后台可以进行IP黑名单限制(支持ip和ip段)
* 部门管理目前是独立的, 仅仅可以和用户进行关联, 关于数据权限需要在具体业务中具体实现(参考: `DataScopeAspect` `@DataScope`)
* 其他功能: 系统参数配置, 数据字典配置, 资金日志(同步+异步), 系统日志(移动端+管理后台), 通知公告, 邮件模板管理, 意见反馈, 帮助中心, 图片管理, 站内信通知模板, 消息推送模板, 菜单管理, 短信日志, 短信模板, 定时任务, 定时任务日志, 第三方授权管理, 缓存管理, 会员管理
* 针对订单后的评分. 门票(门票), 民宿(民宿), 餐饮(餐饮券 + 餐饮店), 线路(线路 + 旅行社), 零售(零售 + 店铺), 场馆(场馆)
* 移动端用户密码: BcEncoder(md5(pwd))
* 平台手续费: 默认订单交易额的百分之5%, 可以修改商户手续费, 注意: 如果订单是零元购, 默认手续费为0, 如果使用了优惠券或积分, 默认手续费按实际支付金额计算.