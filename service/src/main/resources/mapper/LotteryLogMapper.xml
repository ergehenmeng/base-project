<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eghm.mapper.LotteryLogMapper">

    <select id="listPage" resultType="com.eghm.vo.business.lottery.LotteryLogVO" parameterType="com.eghm.dto.business.lottery.LotteryQueryDTO">
        select
            r.prize_name as prizeTitle,
            t.winning,
            r.win_num,
            t.create_time
        from lottery_log t left join lottery_prize r on t.prize_id = r.id
        where t.member_id = #{param.memberId}
        <if test="param.winning != null">
            and t.winning = #{param.winning}
        </if>
        <if test="param.lotteryId != null">
            and t.lottery_id = #{param.lotteryId}
        </if>
        order by t.id desc
    </select>

    <select id="getByPage" resultType="com.eghm.vo.business.lottery.LotteryLogResponse" parameterType="com.eghm.dto.business.lottery.LotteryLotQueryRequest">
        select
        s.avatar,
        s.nick_name,
        r.prize_name as prizeTitle,
        t.winning,
        r.win_num,
        t.create_time
        from lottery_log t
        inner join lottery_prize r on t.prize_id = r.id
        left join `member` s on t.member_id = s.id
        where t.lottery_id = #{param.lotteryId} and r.merchant_id = #{param.merchantId}
        <if test="param.winning != null">
            and t.winning = #{param.winning}
        </if>
        order by t.id desc
    </select>
</mapper>
